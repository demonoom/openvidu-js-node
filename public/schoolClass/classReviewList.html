<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>联合开课列表</title>
    <link rel="icon" href="img/logo_title.png" type="image/x-icon">
    <link rel="shortcut icon" href="img/logo_title.png" type="image/x-icon"/>
    <link href="css/classReviewList.css" rel="stylesheet" >
    <script type="application/javascript" src="js/jquery.min.js"></script>
    <script type="application/javascript" src="js/layer/layer.js"></script>
    <script type="application/javascript" src="js/service.js"></script>
    <script type="application/javascript" src="js/platform.js"></script>
    <style type="text/css">

    </style>
</head>

<body>
<div class="topDiv">
    <h1>课程回顾</h1>
   <!-- <span class="courseBtn" onclick="openUnionClass();">新建课堂</span> -->
</div>

<div id="ul_list">
<div id="item_container">


</div>
<div id="loading" style="display: none;"> 点击加载更多 </div>

</div>




<div class='emptyCont' style="display: none">
    <img src='img/icon_empty.png'/><br/>
    暂无数据
</div>

<div id="item_template" style="display: none;">
    <div class="item">
        <div class="rightCont">
            <div id="title">北京四中和下关四中关于学生品德问题的联合调研</div>
            <div id="main_teacher_name">张三</div>
            <div id="union_teacher_name">李四-王五</div>
            <div id="start_time">开课时间：2018-10-10 09:25</div>
        </div>
        <div id="join_class" class="joinBtn">查看<br/>回顾</div>
    </div>
</div>

</body>


<script type="application/javascript">
    var pageNo = 1;
    var teacherId = Service.getQueryString("teacherId");
            console.log(teacherId,'teacherId');
    var teacherName = Service.getQueryString("teacherName");
    $("#loading").show();
    $(document).ready(function(){
        getUnionClassList();
    });


    //点击加载更多
    $("#loading").on('click',function(){
        if($("#loading").text() == "数据已全部加载"){
            return;
        }else{
            pageNo++;
            getUnionClassList();
        }
//        console.log('加载更多');
    })
    function getUnionClassList() {
       var service = new Service();
       var data = {};
       data.method = 'viewCourseReviewPage';
       data.adminId = teacherId+"";
       data.cType = 3+"";
       data.begin = "2000-01-01";
       data.end = "2050-01-01";
       data.tId = -1+"";
       data.pageNo = pageNo+"";
       $("#loading").text("正在请求数据...");
       service.doWebService(data,{onResponse:function(result){
           var infos = result.response;
           if(infos.length > 0){
               $(".emptyCont").hide();
               $("#loading").text("点击加载更多");
               infos.forEach(function(info){
                   var vid = info.courseId;
                   var title = info.title;
                   var openTeacher = info.teacher;
                   var unionTeachers = info.unionTeachers;
                   var pass = info.password;
                   console.log(info.openTime);
                   var startTime = (info.openTime);
                   var template = $("#item_template");
                   $(template.children("div").get(0)).attr("id","vclass_"+vid);
                   $(template.children("div").get(0)).attr("pass",pass);
                   template.find("#title").text(title);
                   template.find("#main_teacher_name").text("主讲老师 : "+openTeacher.userName);
                   $(template.children("div").get(0)).removeClass("self");
                   template.find("#join_class").html("查看<br/>回顾");
                   template.find("#join_class").attr("onclick","openClassReview("+vid+","+openTeacher.colUid+");");


                   template.find("#start_time").text("开课时间 : "+startTime);
                   var unionTeacherNames = "";
                   if(unionTeachers && unionTeachers.length > 0){
                       unionTeachers.forEach(function(teacher,index){
                           if(index == unionTeachers.length - 1){
                               unionTeacherNames = unionTeacherNames + teacher.userName;
                           }else{
                               unionTeacherNames = unionTeacherNames + teacher.userName+"-";
                           }

                       });
                   }

                   template.find("#union_teacher_name").text("联合老师 : "+unionTeacherNames);

                   $("#item_container").append(template.html());
                   template.attr("info_vid","0");

               });
           }else{
               // $("#loading").text("没有获取到数据...");
               if(pageNo == 1){
                   $(".emptyCont").show();
                   $("#loading").text("")
               }else{
                   $("#loading").text("数据已全部加载");
               }

           }
       },onError:function(error){

       }})
    }

    function openClassReview(clazzId,userId){
        parent.window.postMessage({method:'showReview',vid:clazzId,userId:userId},"*");
    }

    function datetimeFormat(longTypeDate){
        var dateTypeDate = "";
        var date = new Date();
        date.setTime(longTypeDate);
        dateTypeDate += date.getFullYear(); //年
        dateTypeDate += "-" + getMonth(date); //月
        dateTypeDate += "-" + getDay(date); //日
        dateTypeDate += " " + getHours(date); //时
        dateTypeDate += ":" + getMinutes(date);  //分
        return dateTypeDate;
    }

    function getMonth(date){
        var month = "";
        month = date.getMonth() + 1; //getMonth()得到的月份是0-11
        if(month<10){
            month = "0" + month;
        }
        return month;
    }

    function getDay(date){
        var day = "";
        day = date.getDate();
        if(day<10){
            day = "0" + day;
        }
        return day;
    }

    function getHours(date){
        var hours = "";
        hours = date.getHours();
        if(hours<10){
            hours = "0" + hours;
        }
        return hours;
    }

    function getMinutes(date){
        var minute = "";
        minute = date.getMinutes();
        if(minute<10){
            minute = "0" + minute;
        }
        return minute;
    }

</script>
</html>