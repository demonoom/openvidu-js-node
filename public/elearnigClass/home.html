<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小蚂蚁云课堂</title>
    <link rel="icon" href="img/logo_title.png" type="image/x-icon">
    <link rel="shortcut icon" href="img/logo_title.png" type="image/x-icon"/>
    <link rel="stylesheet" href="./css/home.css">
    <link rel="stylesheet" href="./css/datepicker.css">
</head>
<body>

<div class="out_warp">
    <div class="wrap">
        <div class="inner">
            <div class="nav">
                <!--<div class="logo"><img src="img/icon_yunClassLogo.png"/></div>-->
                <div class="logo"><img src="img/abz-logo.png"/></div>
                <div class="userInfo">
                    <div class="my_flex">
                        <div class="avatar">
                            <img id="user_avatar" src="" alt="">
                        </div>
                        <div class="username"></div>
                        <div class="exit">退出</div>
                    </div>
                </div>
            </div>
            <div class="box_cont">
                <div class="left_box">
                    <div class="header">课堂管理</div>
                    <div id="classInfo" class="active">课程信息</div>
                    <div id="myFile">我的课件</div>
                </div>
                <div class="right_box">
                    <!--课程信息 -->
                    <div class="classInfo_box">
                        <iframe id="classInfo_iframe" src="" frameborder="0"></iframe>
                    </div>
                    <!--我的课件 -->
                    <div class="myFile_box">
                        <iframe id="myFile_iframe" src="" frameborder="0"></iframe>
                    </div>
                </div>


            </div>
        </div>
    </div>

</div>



<!-- 课程回顾模块 start-->
<div class="review">
    <div class="review_title createNav">
    <div class="createLeft">課堂回顧</div>
    <div class="createRight" onclick="hideReview()"><img src="img/aBa-close.png" width="12"></div>
</div>
<div class="review_content "></div>
</div>
<!-- 课程回顾模块 end-->

<!--直播回顧模塊 start-->

<div class="chapter_createContent">
    <div class="createNav">
        <div class="createLeft">直播章节</div>
        <div class="createRight" onclick="maskClick()"><img src="img/aBa-close.png" width="12"></div>
    </div>

    <div class="schedule_content_chapter">
        <div class="chapterContent_chapter">1017回顧</div>
        <div class="Course-schedule_time">排课时间(云校直播可以提前5分钟开课)</div>
        <div class="table_chapter ">
            <div class="table_title_chapter">
                <span class="name">章节名称</span>
                <span class="teacher">授课老师</span>
                <span class="time">授课时间</span>
                <span class="operation">操作</span>
            </div>
            <div class="table_data_chapter">
                <!--
                 <div class="list_item">
                                     <span>1</span>
                                     <span><input type="text"></span>
                                     <span>授课老师</span>
                                     <span>授课时间</span>
                                     <span class="deleteClass">删除</span>
                                 </div>
                 -->
            </div>
        </div>
    </div>
    <div class="schedule_footer"><button class="submitBlue" onclick="maskClick()">关闭</button></div>
</div>

<!--直播回顧模塊 end-->


<!-- 新建课堂模块 start-->
<div class="class_createContent">
    <div class="createNav">
        <div class="createLeft"></div>
        <div class="createRight" onclick="maskClick()"><img src="img/aBa-close.png" width="12"></div>
    </div>
    <div class="content create-content">
        <div class="create-contentList">
            <span class="create-contentLeft">课程名称</span><input id="class_name" class="add-CourseName" type="text">
        </div>
        <div class="create-contentList">
            <span class="create-contentLeft">课程封面</span>
            <div class="image_box">
            </div>
            <button id="uploadImage" class="uploadImage" onclick="uploadImage()">上传</button>

        </div>
        <div class="create-contentList">
            <span class="create-contentLeft">课程概述</span><textarea id="class_info" class="add-CourseName" rows="4" ></textarea>
        </div>
    </div>

    <div class="schedule_content">
        <div class="create-contentLeft setUp-Left">设置课表</div>
        <div class="table table-right">
            <div class="table_title">
                <span class="table_title_number">课时</span>
                <span class="table_title_name">名称</span>
                <span class="table_title_teacher public-textHidden">授课老师</span>
                <span class="table_title_time">授课时间</span>
                <span class="table_title_del">操作</span>
            </div>
            <div class="table_data">
                <!--
                 <div class="list_item">
                                     <span>1</span>
                                     <span><input type="text"></span>
                                     <span>授课老师</span>
                                     <span>授课时间</span>
                                     <span class="deleteClass">删除</span>
                                 </div>
                 -->
            </div>
            <div class="table_bottom">
                <button class="add-class bottom-15" onclick="addVideos('','')">添加课时</button>
                <div class="bottom-15 release"><input id="isPublish" class="Publish-btn" type="checkbox" onchange="isPublish_change()">立即发布</div>
            </div>
        </div>
    </div>
    <div class="submit-btn">
        <button class="submitBlue" onclick="submitClass()">提交</button>
    </div>
</div>
<div class="mask" onclick="maskClick()"></div>
<input id="upload" type="file" accept=".jpg,.png,.gif,.PNG,.JPG,.GIF">

<!-- 新建课堂模块 end-->

</body>
<script src="../schoolClass/js/jquery.min.js"></script>
<script src="./js/plugins/moment.min.js"></script>
<script src="./js/datepicker.all.js"></script>
<script type="application/javascript" src="../schoolClass/js/layer/layer.js"></script>
<script type="application/javascript" src="../schoolClass/js/service.js"></script>
<script>
    // 课程封面
    var imagePath = '';
    //是否发布
    var isPublish = 2;
    //章节index
    var class_index = 0;
    var teacherId, teacherName;
    //章节对象
    var videos = new Array();
    //是否编辑状态
    var editorFlag = false;
    var editorId = null;
    //    // 当前输入框下标
    //    var inputIndex = 0;
    //    //当前时间框下标
    //    var timeIndex = 0;
    //    var that = this;
    //    var service = new Service();
    $(function () {

        teacherId = Service.getQueryString("teacherId");
        teacherName = Service.getQueryString("teacherName");

        //获取用户信息
        getUserById();
        //给iframe赋值
        $('#classInfo_iframe').attr('src', 'createClass.html?teacherId=' + teacherId + '&teacherName=' + teacherName + '')
//        $('#myFile_iframe').attr('src', 'https://jiaoxue.maaee.com:8099/#/antPlate?ident=' + teacherId + '&fileId=-1&title=蚁盘题目&phoneType=0')

        //默认添加一行章节
        addVideos('', '',function(){

        });

        //点击课程信息
        $('#classInfo').on('click', function () {
            $('#classInfo').addClass('active');
            $('#myFile').removeClass('active');
            $('.classInfo_box').show();
            $('.myFile_box').hide();
        })



        //点击我的课件
        $('#myFile').on('click', function () {
            $('#myFile').addClass('active');
            $('#classInfo').removeClass('active');
            $('.classInfo_box').hide();
            $('.myFile_box').show();
        })


        //退出登录
        $('.exit').on('click', function () {
            layer.confirm('您确定要退出登录?', {
                btn: ['确定', '取消'] //按钮
            }, function () {
                window.location.href = 'login.html'
            }, function () {
            });
        });


        //获取用户信息
        function getUserById() {
            debugger
            $.ajax({
                type: "POST",
                url: "https://www.maaee.com/Excoord_For_Education/webservice",
//                url:"http://192.168.50.15:9007/elearning/elearningControl/",
                data: {
                    params: JSON.stringify({
                        "method": "getUserById",
                        "ident": teacherId,
                    })
                },
                header: {
                    "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
                },
                success: function (data) {
                    var res = JSON.parse(data);
                    console.log(res,'牛');
                    if (res.success) {
                        $('#user_avatar').attr('src', res.response.avatar);
                        $('.username').text(res.response.userName);

                    } else {
                        alert('用户不存在');
                    }
                },
                error: function (e) {
                    console.log(e);
                }
            });
        }

    })

// 已发布 未发布 change
    function isPublish_change() {
        console.log();
        if ($('#isPublish').attr('checked')) {
            isPublish = 1;
        } else {
            isPublish = 2;
        }
    }

    //子页面调用新建课堂
    function createClass() {
        $('.createLeft').text('新建课堂');
        $('.class_createContent').show(150);
        $('.mask').show();
    }


    //子页面调用直播页面
    function showIframe(id, publisher_id){
        $.ajax({
                    type: "POST",
//                    url: "http://192.168.50.15:9007/elearning/elearningControl/",
                    url: "http://www.maaee.com/elearning/elearningControl/",
                    data: {
                        params: JSON.stringify({
                            method: "getCourseByCourseId",
                            id: id,
                            publisher_id: publisher_id,
                        })
                    },
                    header: {
                        "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
                    },
                    success: function (data) {
                        var res = JSON.parse(data);
                        console.log(res,'获取直播数据');
                        if(res.success){
                            $('.table_data_chapter').empty();
                            var video = res.response.videos;
                            $('.chapterContent_chapter').text(res.response.content)
                            for(var k in video){
                                console.log(video[k]);
                                var flag = video[k].videoStatus == 1?'未开课':video[k].videoStatus == 2?'正在直播':'课程回顾';
                                var flagClass = video[k].videoStatus == 1?'aBa-notPlay':video[k].videoStatus == 2?'aBa-play':'aBa-review';
                                $('.table_data_chapter').append("<div class='list_item'>\n" +
                                   "                                 <span class='name'>"+video[k].name+"</span>\n" +
                                   "                                 <span class='teacher'>" + teacherName + "</span>\n" +
                                   "                                 <span class='time timeList'>"+formatTime(new Date(video[k].liveTime),true)+"</span>\n" +
                                   "                                 <span class='operation'><button class='"+flagClass+"' onclick='toLive(\""+flag+"\","+JSON.stringify(video[k])+")'></button></span>\n" +
                                   "                                 </div>");
                            }

                        }

                    },
                    error: function (e) {
                        console.log(e);
                    }
                });
        $('.chapter_createContent').show(150);
        $('.mask').show();
    }

    //关闭新建课堂小窗口
    function maskClick() {
        initData();
        $('.mask').hide();
        $('.class_createContent').hide();
        $('.chapter_createContent').hide();
        $('.review').hide();
        editorFlag = false;
    }

    //    //添加课时章节
    //    function addClass() {
    //        addVideos('','',class_index);
    //    }

    function addVideos(name, liveTime, callback) {
//        console.log('你好我是王教练');
        class_index++;
        $('.table_data').append("<div class='list_item table_title'>\n" +
            "<span class='table_title_number table_title_numberT'>" + class_index + "</span>\n" +
            "<span class='table_title_name'><input oninput='input_chapterName(" + (class_index - 1) + ",this)' type='text'></span>\n" +
            "<span class='table_title_teacher public-textHidden'>" + teacherName + "</span>\n" +
            "<div class=\"c-datepicker-date-editor c-datepicker-single-editor J-datepicker-day mt10 table_title_time\">\n"+
            "                              <i class=\"c-datepicker-range__icon kxiconfont icon-clock\"></i>\n"+
            "                              <input type=\"text\" autocomplete=\"off\" name=\"\" placeholder=\"选择日期\" class=\" c-datepicker-data-input only-date\" value=\"\">\n"+
            "                    </div> "+
            "<span class='table_title_del' onclick='delete_chapter(" + (class_index - 1) + ",this)'><i></i></span>\n" +
            "</div>");
        videos.push({
            name: name,
            liveTime: new Date(liveTime).getTime(),
            userID: teacherId,
            squence: class_index
        });
        initDate();

        if(callback){
            callback();
        }
        console.log(videos, 'videos');
    }

    //删除课时章节
    function delete_chapter(index, event) {
//        console.log(event,'event');
//        console.log(index);
//        console.log($(event).parent().index(), '下标');
        videos.splice($(event).parent().index(), 1);
//        return;
        $(event).parent().remove();
    }

//    $('.deleteClass').live('click', function (event) {
//        console.log($(this).parent().remove());
//    })

    function submitClass() {
        var warn = '';
        if ($('#class_name').val() == '') {
            warn = "课程名称不能为空";
        } else if (imagePath == '') {
            warn = "请上传课程封面";
        } else if ($('#class_info').val() == '') {
            warn = "课程概述不能为空";
        }
        if (warn == '') {
            for (var k in videos) {
                if (videos[k].name == '') {
                    warn = "课程章节第" + (parseInt(k) + 1) + "行章节名称不能为空!";
                } else if (videos[k].liveTime == '') {
                    warn = "课程章节第" + (parseInt(k) + 1) + "行章节时间不能为空!";
                } else {
                }
            }
        }
//        console.log($('#class_name').val(),'课程名称');
//        console.log(imagePath,'课程封面');
//        console.log($('#class_info').val(),'课程概述');
//        console.log(isPublish,'是否立即发布');
//        console.log(teacherId,'发布者id');
//        console.log(videos,'videos');
//        videos = new Array();
//        videos = [];
//        console.log(videos);
//        return;
        if (warn != '') {
            layer.msg(warn);
        } else {
            if(editorFlag){
                updateCourse($('#class_name').val(), imagePath, $('#class_info').val(), isPublish, teacherId, videos,editorId);
            }else{
                openClass($('#class_name').val(), imagePath, $('#class_info').val(), isPublish, teacherId, videos);
            }

        }
    }

    function input_chapterName(index, event) {
//        console.log(index);
//        console.log(videos[$(event).parent().parent().index()]);
        videos[$(event).parent().parent().index()].name = $(event).val().trim();
//        console.log($(event).parent().parent().index(),'下标');
//        console.log($(event).val().trim(),'章节名称');
    }

    function input_chapterTime(index, event) {
//        console.log($(event).val().trim());
console.log($(event.$input).parent().parent().index(),'下标')
//        console.log(event.$input.val(),'日期');
        videos[$(event.$input).parent().parent().index()].liveTime = new Date(event.$input.val().trim()).getTime();
//        console.log($(event).parent().parent().index(),'下标');
//        console.log($(event).val().trim(),'章节时间');
    }



    function updateCourse(class_name, class_imagePath, class_info, isPublish, teacherId, videos,id){
        $.ajax({
                    type: "POST",
//                    url: "http://192.168.50.15:9007/elearning/elearningControl/",
                    url: "http://www.maaee.com/elearning/elearningControl/",
                    data: {
                        params: JSON.stringify({
                            method: "updateCourse",
                            data: JSON.stringify({
                                courseName: class_name,
                                content: class_info,
                                image: class_imagePath,
                                isPublish: isPublish,
                                publisher_id: teacherId,
                                videos: videos,
                                schoolId: 401,
                                id:id
                            })
                        })
                    },
                    header: {
                        "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
                    },
                    success: function (data) {
                        console.log(JSON.parse(data), '保存');
                        var res = JSON.parse(data);
                        if (res.success) {
                            layer.msg('编辑成功!');
                            //关闭modal且初始化数据
                            maskClick();
                            document.getElementById('classInfo_iframe').contentWindow.refresh();
                        } else {
                            layer.msg(res.msg, '编辑失败');
                        }
                    },
                    error: function (e) {
                        console.log(e);
                    }
                });
    }


    function updateClass(id, publisher_id) {
        console.log(id, '课程ｉｄ');
        console.log(publisher_id, 'publisher_id');
        editorFlag = true;
        initData();

        $.ajax({
            type: "POST",
//            url: "http://192.168.50.15:9007/elearning/elearningControl/",
            url: "http://www.maaee.com/elearning/elearningControl/",
            data: {
                params: JSON.stringify({
                    method: "getCourseByCourseId",
                    id: id,
                    publisher_id: publisher_id,
                })
            },
            header: {
                "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
            },
            success: function (data) {
                var res = JSON.parse(data);

                console.log(res,'获取编辑数据');
                if(res.success){
                    var data = res.response;
                    var video = data.videos;
                    videos.splice(0);
                    createClass();
                    $('.createLeft').text('编辑课堂');
                    $('.table_data').empty();
                    $('.image_box').empty();
//                    console.log(data.courseName,'课程名称');
//                    console.log(data.content,'课程概述');
//                    console.log(data.isPublish,'已发布');
//                    console.log(data.image,'课程封面');
                    //image回填
                    imagePath = data.image;
                    $('.image_box').html("<img src=" + imagePath + " class='class_image'>");
                    //课程名称
                    $('#class_name').val(data.courseName);
                    //课程概述
                    $('#class_info').val(data.content);
                    //复选框回填
                    isPublish = data.isPublish;
                    editorId = data.id;
                    if(data.isPublish == 1){ // 已发布
                        $('#isPublish').attr("checked",true);
                    }else if(isPublish == 2){ // 未发布
                        $('#isPublish').removeAttr("checked");
                    }
//                    console.log(formatTime(new Date(video[0].liveTime)),'sdasd')
                    console.log(formatTime(new Date(video[0].liveTime),true),'riqi');
                    // 章节videos 对象回填
                    for(var k in video){
                        $('.table_data').append("<div class='list_item table_title'>\n" +
                                    "<span class='table_title_number table_title_numberT'>" + video[k].squence + "</span>\n" +
                                    "<span class='table_title_name'><input value="+video[k].name+" oninput='input_chapterName(" + (class_index - 1) + ",this)' type='text'></span>\n" +
                                    "<span class='table_title_teacher public-textHidden'>" + teacherName + "</span>\n" +
                                    "<div class=\"c-datepicker-date-editor c-datepicker-single-editor J-datepicker-day mt10 table_title_time\">\n"+
                                    "                              <i class=\"c-datepicker-range__icon kxiconfont icon-clock\"></i>\n"+
                                    "                              <input type=\"text\" autocomplete=\"off\" name=\"\" placeholder='"+formatTime(new Date(video[k].liveTime),true)+"' class=\" c-datepicker-data-input only-date\" value=\"\">\n"+
                                    "                    </div> "+
                                    "<span class='table_title_del' onclick='delete_chapter("+video[k].squence+",this)' class='table_title_del'><i></i></span>\n" +
                                    "</div>");
                                videos.push({
                                    name: video[k].name,
                                    liveTime: video[k].liveTime,
                                    userID: teacherId,
                                    squence: video[k].squence,
                                    id: video[k].id
                                });
                                initDate();

                    }
                }

            },
            error: function (e) {
                console.log(e);
            }
        });

    }




    function deleteClass(id, publisher_id){
        layer.confirm('确定删除吗?', {
          btn: ['确定','取消'] //按钮
        }, function(){
            $.ajax({
                                type: "POST",
//                                url: "http://192.168.50.15:9007/elearning/elearningControl/",
                                url: "http://www.maaee.com/elearning/elearningControl/",
                                data: {
                                    params: JSON.stringify({
                                        method: "deleteCourse",
                                        id: id,
                                    })
                                },
                                header: {
                                    "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
                                },
                                success: function (data) {
                                    var res = JSON.parse(data);
                                    console.log(res,'删除数据');
                                    if(res.success){
                                        layer.msg('删除成功');
                                        setTimeout(function(){
                                        document.getElementById('classInfo_iframe').contentWindow.refresh();
                                        },300)
                                    }else{
                                        layer.msg('删除失败');
                                    }

                                },
                                error: function (e) {
                                    console.log(e);
                                }
                            });
        }, function(){

        });

    }


    function openClass(class_name, class_imagePath, class_info, isPublish, teacherId, videos) {
        debugger
        $.ajax({
            type: "POST",
//            url: "http://192.168.50.15:9007/elearning/elearningControl/",
            url: "http://www.maaee.com/elearning/elearningControl/",
            data: {
                params: JSON.stringify({
                    method: "addCourse",
                    jsonObject: JSON.stringify({
                        courseName: class_name,
                        content: class_info,
                        image: class_imagePath,
                        isPublish: isPublish,
                        publisher_id: teacherId,
                        videos: videos,
                        schoolId: 401
                    })
                })
            },
            header: {
                "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
            },
            success: function (data) {
                console.log(JSON.parse(data), '保存');
                var res = JSON.parse(data);
                if (res.success) {
                    layer.msg('保存成功!');
                    maskClick();
                    //开始初始化
//                    initData();
                    document.getElementById('classInfo_iframe').contentWindow.refresh();
                } else {
                    layer.msg(res.msg, '保存失败');
                }
            },
            error: function (e) {
                console.log(e);
            }
        });
    }


    function hideReview(){
        $('.review').hide();
    }

    //    上传图片
    function uploadImage() {
        $("#upload").click();
        //取消加绑定change事件解决change事件无法控制
        $("#upload").off("change");
        $("#upload").change(function () {
            if (this.files[0]) {
                var formData = new FormData();
                formData.append("file" + 0, this.files[0]);
                formData.append("name" + 0, this.files[0].name);
                $.ajax({
                    type: "POST",
                    url: "https://jiaoxue.maaee.com:8890/Excoord_Upload_Server/file/upload",
                    enctype: 'multipart/form-data',
                    data: formData,
                    // 告诉jQuery不要去处理发送的数据
                    processData: false,
                    // 告诉jQuery不要去设置Content-Type请求头
                    contentType: false,
                    success: function (res) {
                        //返回在线图片地址
//                        console.log(res);
                        imagePath = res;
                        $('.image_box').html("<img src=" + res + " class='class_image'>")
                    }
                });
            }
        })
    }



    function toLive(flag,video){
        console.log(flag);
        if(flag == '未开课' || flag == '正在直播'){

//            console.log(video);
//            console.log(video.liveTime);
//            layer.msg('正在开启..');
        var originTime = video.liveTime;
        //获取当前时间 时间戳
        var rightTime = new Date();
        var isCurrentDay = isToday(originTime);
        if ((originTime - 300000) > Date.parse(rightTime)) {
            layer.msg('未到开课时间');
            return;
        } else if (isCurrentDay === false) {
            layer.msg('授课时间已过,请修正后再重新开课,谢谢!');
            return;
        }else{
            $.ajax({
                        type: "POST",
//                        url: "http://192.168.50.15:9007/elearning/elearningControl/",
                        url: "http://www.maaee.com/elearning/elearningControl/",
                        data: {
                            params: JSON.stringify({
                                method: "findVideoById",
                                "id": video.id,
                            })
                        },
                        header: {
                            "content-type": "application/x-www-form-urlencoded;charset=UTF-8"
                        },
                        success: function (data) {
                            var res = JSON.parse(data);
                            console.log(res);
                            if (res.success) {
                                var targetType = 1;
                                var userId = teacherId;
                                var targetId = res.response.id;
                                var title = res.response.name;
                                var requestUrl = "https://www.maaee.com/Excoord_PhoneService/elearningClass/teacherElearningLive/"
                                requestUrl += 23836 + "/" + targetType + "/" + targetId + "/" + title + "?title=" + title;
                                window.open(requestUrl);
                            } else {
                                layer.msg(res.msg, '查询失败');
                            }
                        },
                        error: function (e) {
                            console.log(e);
                        }
                    });
        }


        }else if(flag == '课程回顾'){
//            layer.msg('课程回顾');
            var requestUrl = 'http://jiaoxue.maaee.com:8093/#/cloundSchoolDetail';
            requestUrl += "?vid="+video.virtual_classId+"&userId="+teacherId+"&type=2"+"&name="+encodeURI(video.name);

            $('.review_content').empty();
            $('.review').show();
            $('.review_content').append("" +
             "<iframe src="+requestUrl+"></iframe>" +
              "")
            //            window.open(requestUrl);
//            http://jiaoxue.maaee.com:8093/#/cloundSchoolDetail?vid=223741&userId=129392&type=2&name=%E5%9B%9E%E9%A1%BE
        }
    }

    //初始化modal
    function initData(){
        class_index = 0;
        videos.splice(0)
        isPublish = 2;
        imagePath = '';
        $('#class_name').val('');
        $('#class_info').val('');
        $('.table_data').empty();
        $('.image_box').empty();
        $('#isPublish').removeAttr("checked");
        addVideos('', '');
    }

    function initDate(){
        console.log('构建日期')
                var DATAPICKERAPI = {
                          // 默认input显示当前月,自己获取后填充
                          activeMonthRange: function () {
                            return {
                              begin: moment().set({ 'date': 1, 'hour': 0, 'minute': 0, 'second': 0 }).format('YYYY-MM-DD HH:mm:ss'),
                              end: moment().set({ 'hour': 23, 'minute': 59, 'second': 59 }).format('YYYY-MM-DD HH:mm:ss')
                            }
                          },
                };
                          //年月日单个
                          $('.J-datepicker-day').datePicker({
                            hasShortcut: true,
                            format:'YYYY-MM-DD HH:mm',
                            shortcutOptions: [{
                              name: '今天',
                              day: '0'
                            }, {
                              name: '昨天',
                              day: '-1'
                            }, {
                              name: '一周前',
                              day: '-7'
                            }],
                            hide:function(){
                                   // 单个选择时
                                    console.info(this.$input.val());
                                    console.log(this);
                                    input_chapterTime(0,this);
                            }
                          });
            }

    function formatTime(date,HMS) {
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        const hour = date.getHours();
        const minute = date.getMinutes();
        const second = date.getSeconds();
//        return [year, month, day].map(formatNumber).join('-') + ' ' + [hour, minute, second].map(formatNumber).join(':')
        return HMS?[year, month, day].map(formatNumber).join('-') + ' ' + [hour, minute, second].map(formatNumber).join(':'):[year, month, day].map(formatNumber).join('-');
    }
    function formatNumber(n) {
        n = n.toString() ;
        return n[1] ? n : '0' + n;
    }

    function isToday(str){
        var isToday=false;
            if (new Date(parseInt(str)).toDateString() === new Date().toDateString()) {
                //今天
                isToday=true;
            } else if (new Date(parseInt(str)) < new Date()){
                //之前
                isToday=false;
            }
            return isToday;
    }
</script>
</html>